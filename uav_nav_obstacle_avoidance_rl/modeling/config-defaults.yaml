# ── Environment ──────────────────────────────────────────────
env:
  start_pos: [0.0, 0.0, 1.0]              # UAV start position
  # Boundary
  grid_sizes: [50.0, 50.0, 5.0]     # [x, y, z] in meters — occupancy grid uses (x, y), z is for wall/obstacle height
  cell_size: 1.0                    # 2D occupancy grid cell size (meters)
  min_height: 0.01                  # min flight height; collision below this

  # Waypoints
  num_targets: 1                    # (controlled by curriculum learning)
  target_distance_range: null       # [min_r, max_r] or None for unconstrained; set by curriculum
  sparse_reward: false
  use_yaw_targets: false            # toggles whether the agent must also align its yaw (heading) to a per‐waypoint target before that waypoint is considered “reached,” and whether yaw error is included in the observation.
  goal_reach_distance: 0.2          # distance in meters within which the target is considered reached
  goal_reach_angle: 0.1             # radians

  # Obstacles
  num_obstacles: 0                  # (controlled by curriculum learning)
  obstacle_shapes: ['cylinder']     # ['cylinder', 'box', 'sphere']
  obstacle_size_range: [0.5, 0.5]   # [min, max] fraction of cell_size
  visual_obstacles: false           # render meshes (eval only)

  # Simulation
  max_duration_seconds: 80.0        # max simulation time of the env
  flight_mode: 5                    # PyFlyt velocity control (u, v, vr, vz)
  angle_representation: "quaternion" # "euler" or "quaternion"
  agent_hz: 30                      # looprate of the agent to environment interaction
  render_mode: null                 # "human" or "rgb_array" or None
  render_resolution: [480, 480]

  # LiDAR / Perception
  perception_mode: "lidar"          # none | lidar
  lidar:
    num_rays_horizontal: 36
    num_rays_vertical: 1
    max_range: 10.0                 # meters
    min_range: 0.1                  # meters
    fov_horizontal: 360.0           # degrees  # XXX adjust angle calculations in lidar wrapper if < 360.0
    fov_vertical: 30.0              # degrees
    ray_start_offset: 0.15          # meters from drone center
    normalize_distances: true
    add_to_obs: "separate"          # append | separate | replace

# ── Curriculum Learning ──────────────────────────────────────
# When curriculum is disabled, env defaults above are used directly.
# When enabled, each stage overrides env defaults for difficulty parameters.
curriculum:
  enabled: false
  advance_threshold: 0.8
  advance_patience: 5
  regress_threshold: 0.4
  regress_patience: 3
  window_size: 10000
  stages:
    - stage: 0
      desc: "Open space — learn flight and navigation"
      num_obstacles_range: [0, 0]
      obstacle_shapes: ["cylinder"]
      obstacle_size_range: [0.3, 0.5]
      num_targets: 1
      target_distance_range: [2.0, 4.0]

    - stage: 1
      desc: "A few obstacles along the flight path"
      num_obstacles_range: [1, 3]
      obstacle_shapes: ["cylinder"]
      obstacle_size_range: [0.3, 0.5]
      num_targets: 1
      target_distance_range: [3.0, 6.0]

    - stage: 2
      desc: "More obstacles, introduce boxes"
      num_obstacles_range: [3, 6]
      obstacle_shapes: ["cylinder", "box"]
      obstacle_size_range: [0.2, 0.7]
      num_targets: 1
      target_distance_range: [3.0, 8.0]

    - stage: 3
      desc: "Dense, mixed shapes and sizes"
      num_obstacles_range: [5, 10]
      obstacle_shapes: ["cylinder", "box"]
      obstacle_size_range: [0.2, 0.9]
      num_targets: 1
      target_distance_range: [4.0, 10.0]

    - stage: 4
      desc: "Dense field, longer distances"
      num_obstacles_range: [8, 12]
      obstacle_shapes: ["cylinder", "box"]
      obstacle_size_range: [0.2, 1.0]
      num_targets: 1
      target_distance_range: [5.0, 12.0]

    - stage: 5
      desc: "Full difficulty — any distance, dense obstacles"
      num_obstacles_range: [10, 15]
      obstacle_shapes: ["cylinder", "box"]
      obstacle_size_range: [0.1, 1.0]
      num_targets: 1
      target_distance_range: null           # unconstrained

# ── PPO Hyperparameters ──────────────────────────────────────
ppo:
  learning_rate: 0.0003
  batch_size: 64
  n_steps: 2048
  gamma: 0.99
  gae_lambda: 0.95
  clip_range: 0.2
  ent_coef: 0.0
  vf_coef: 0.5
